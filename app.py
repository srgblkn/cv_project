import streamlit as st
from datetime import datetime


APP_TITLE = "cv_project ‚Äî Computer Vision multipage app"
APP_ICON = "üß†"  # –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ "üì∑" –∏–ª–∏ —É–±—Ä–∞—Ç—å


def render_header():
    st.set_page_config(
        page_title=APP_TITLE,
        page_icon=APP_ICON,
        layout="wide",
        initial_sidebar_state="expanded",
    )
    st.title(APP_TITLE)
    st.caption(
        "YOLO (–ª–∏—Ü–∞ + –æ–ø—É—Ö–æ–ª–∏) –∏ U-Net (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è). "
        "–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —à–∞–±–ª–æ–Ω –±–ª–æ–∫–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏."
    )


def render_sidebar():
    st.sidebar.header("–ù–∞–≤–∏–≥–∞—Ü–∏—è")
    st.sidebar.write(
        "–ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É `pages/`, Streamlit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∂–µ—Ç –∏—Ö –≤ –º–µ–Ω—é —Å–ª–µ–≤–∞."
    )

    st.sidebar.divider()
    st.sidebar.subheader("–°—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–ª–∞–Ω)")
    st.sidebar.markdown(
        "- Face anonymizer (YOLO)\n"
        "- Brain tumor detection (YOLOv11) + –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ\n"
        "- Forest segmentation (U-Net)\n"
    )

    st.sidebar.divider()
    st.sidebar.caption(f"–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")


def render_project_overview():
    col1, col2 = st.columns([1.3, 1.0], gap="large")

    with col1:
        st.subheader("–ß—Ç–æ –¥–µ–ª–∞–µ–º –≤ –ø—Ä–æ–µ–∫—Ç–µ")
        st.markdown(
            """
**–¢—Ä–∏ –∑–∞–¥–∞—á–∏ –≤ –æ–¥–Ω–æ–º multipage Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
1) **–î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü** —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π **–º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π** –æ–±–ª–∞—Å—Ç–∏ –ª–∏—Ü–∞  
2) **–î–µ—Ç–µ–∫—Ü–∏—è –æ–ø—É—Ö–æ–ª–µ–π –º–æ–∑–≥–∞** –Ω–∞ —Ñ–æ—Ç–æ/—Å–Ω–∏–º–∫–µ (YOLOv11, –ø–∞–ø–∫–∞ `axial_t1wce_2_class`)  
3) **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ª–µ—Å–∞** –Ω–∞ –∞—ç—Ä–æ–∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö —Å–Ω–∏–º–∫–∞—Ö (U-Net, –±–∏–Ω–∞—Ä–Ω–∞—è –º–∞—Å–∫–∞)

**–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞:**
- –ù–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: –∑–∞–≥—Ä—É–∑–∫–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤** (multiple upload)
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ **–ø–æ URL**
- –ù–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: –±–ª–æ–∫ ‚Äú–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏‚Äù (—ç–ø–æ—Ö–∏, –æ–±—ä—ë–º—ã, –º–µ—Ç—Ä–∏–∫–∏, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
            """
        )

    with col2:
        st.subheader("–ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è")
        st.markdown(
            """
- [x] `app.py` (Home)
- [x] `requirements.txt`
- [x] `.gitignore`
- [x] `README.md`
- [ ] `pages/` (–¥–æ–±–∞–≤–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ)
- [ ] `models/` (–ª–æ–∫–∞–ª—å–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤–µ—Å–∞)
- [ ] `data/` (–ª–æ–∫–∞–ª—å–Ω–æ –¥–∞—Ç–∞—Å–µ—Ç—ã)
            """
        )


def render_upload_demo():
    st.subheader("–î–µ–º–æ: –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü)")
    st.write("–≠—Ç–æ –ø—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ–µ–∫—Ç–∞.")

    files = st.file_uploader(
        "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)",
        type=["png", "jpg", "jpeg", "bmp", "tif", "tiff"],
        accept_multiple_files=True,
    )

    if not files:
        st.info("–§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ù–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö —Å—é–¥–∞ –ø–æ–¥–∫–ª—é—á–∏–º –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–µ–π.")
        return

    st.success(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: {len(files)}")
    with st.expander("–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤", expanded=False):
        for f in files:
            st.write(f"- {f.name} ({f.size} bytes)")


def render_model_info_template():
    st.subheader("–®–∞–±–ª–æ–Ω: –±–ª–æ–∫ ¬´–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏¬ª (–±—É–¥–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ)")
    st.caption("–ü–æ–∫–∞ —ç—Ç–æ —à–∞–±–ª–æ–Ω. –ö–æ–≥–¥–∞ –æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–æ–π.")

    with st.expander("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏ / –∫–∞—á–µ—Å—Ç–≤–µ / –æ–±—É—á–µ–Ω–∏–∏", expanded=True):
        c1, c2, c3 = st.columns(3)

        with c1:
            st.markdown("**–û–±—É—á–µ–Ω–∏–µ**")
            st.write("- –≠–ø–æ—Ö–∏: _TBD_")
            st.write("- –†–∞–∑–º–µ—Ä train: _TBD_")
            st.write("- –†–∞–∑–º–µ—Ä val: _TBD_")

        with c2:
            st.markdown("**–ú–µ—Ç—Ä–∏–∫–∏**")
            st.write("- mAP@0.5: _TBD_ (–¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏)")
            st.write("- PR curve: _TBD_")
            st.write("- Confusion matrix: _TBD_")
            st.write("- IoU / Dice: _TBD_ (–¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏)")

        with c3:
            st.markdown("**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**")
            st.write("- _TBD_ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤, –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –ø–æ—Ä–æ–≥ confidence)")

        st.divider()
        st.markdown(
            """
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É:**
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤–µ—Å–∞ –∫–∞–∂–¥—ã–µ N —ç–ø–æ—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 2‚Äì5 —ç–ø–æ—Ö).
- –î–ª—è —Å–µ—Ä–≤–∏—Å–∞ —ç—Ç–æ —É–¥–æ–±–Ω–æ: –∑–∞–º–µ–Ω–∏–ª–∏ —Ñ–∞–π–ª –≤–µ—Å–æ–≤ ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –∫–æ–¥–∞.
            """
        )


def main():
    render_header()
    render_sidebar()

    render_project_overview()
    st.divider()

    render_upload_demo()
    st.divider()

    render_model_info_template()


if __name__ == "__main__":
    main()
